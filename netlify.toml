[build]
  command = "npm run build"
  publish = "lib"
  functions = "netlify/functions"

[context.production.environment]
  NODE_VERSION = "20"

[[redirects]]
  from = "/*"
  to = "/.netlify/functions/index"
  status = 200

[functions]
  # 1. 启用 esbuild：让它帮我们生成正确的 ESM 入口文件
  node_bundler = "esbuild"
  
  # 2. 核心大招：告诉 esbuild "所有的依赖都不要打包！"
  # 这样既避免了 .art 报错，又避免了体积超限
  external_node_modules = ["*"]
  
  # 3. 强制携带文件：依赖虽然不打包，但必须物理复制过去
  included_files = ["lib/**", "package.json"]
